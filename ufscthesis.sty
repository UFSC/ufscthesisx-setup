%% abntex2-ufsc.sty
%%
%% Copyright 2017 Evandro Coan
%% Copyright 2012-2016 by abnTeX2 group at https://www.abntex.net.br/
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `maintained'.
%% The Current Maintainer of this work is the Evandro Coan.
%%
%% The last Maintainer of this work was the abnTeX2 team, led
%% by Lauro César Araujo. Further information are available on
%% https://www.abntex.net.br/
%%
%% This work consists of the file `abntex2-ufsc.sty` renamed as follows:
%% Renamed the `abntex2.cls, v-1.9.6 laurocesar` to `abntex2-ufsc.sty`
%%

% Define versão necessária do LaTeX
\NeedsTeXFormat{LaTeX2e}
% \ProvidesPackage{abntex2-ufsc}[2017/08/13 v0.0.1 Evandro]

% Now we'll execute any options passed in
\ProcessOptions\relax

% Indent the first section paragraphs
% https://tex.stackexchange.com/questions/39227/no-indent-in-the-first-paragraph-in-a-section
\RequirePackage{indentfirst}

% The class memoir already provides these functionalities: Caption package and Memoir
% https://groups.google.com/forum/#!topic/comp.text.tex/RzpI2ATMev0
% https://tex.stackexchange.com/questions/18931/memoir-class-with-subcaption-and-hyperref-packages
%
% \RequirePackage{caption}
% \RequirePackage{subfig}
% \RequirePackage{etoolbox}

% The package `layouts` causes the: Warning: layout scale set to 0.5 on input line
% https://tex.stackexchange.com/questions/299372/warning-layout-scale-set-to-0-5-on-input-line
% \RequirePackage{layouts}



% CONFIGURAÇÕES DE PACOTES
%
\newcommand{\ifnotempty}[2]{\ifthenelse{\not\equal{#1}{}}{#2}{}}

% Comandos de dados - programa
\providecommand{\imprimirprograma}{}
\newcommand{\programa}[1]{\renewcommand{\imprimirprograma}{#1}}

\newcounter{ufscthesis@assuntos}
\providecommand{\listaassuntos}{}
\providecommand{\imprimirassuntos}
{%
    \setcounter{ufscthesis@assuntos}{1}
    \@for\assunto:={\listaassuntos}\do
    {%
        \arabic{ufscthesis@assuntos}.\assunto. %
        \addtocounter{ufscthesis@assuntos}{1}
    }
}
\newcommand{\assuntos}[1]{\renewcommand{\listaassuntos}{#1}}

\providecommand{\imprimircentro}{}
\newcommand{\centro}[1]{\renewcommand{\imprimircentro}{#1}}


\RequirePackage{amsthm}
\newtheorem{axioma}{Axioma}[chapter]
\newtheorem{postulado}{Postulado}[chapter]
\newtheorem{teorema}{Teorema}[chapter]
\newtheorem{conjectura}{Conjectura}[chapter]
\newtheorem{corolario}{Coral\'ario}[teorema]
\newtheorem{lema}[teorema]{Lema}
\newtheorem{proposicao}{Proposi\c{c}\~ao}[teorema]


% Commonly used in definitions, conditions, problems and examples.
\theoremstyle{definition}
\newtheorem{definicao}{Defini\c{c}\~ao}[section]
\newtheorem{exemplo}{Exemplo}[section]
\newtheorem{exercicio}{Exerc\'icio}[section]
\newtheorem{condicao}{Condi\c{c}\~ao}[section]


\theoremstyle{remark}
\newtheorem*{observacao}{Observa\c{c}\~ao}


% Margens
\setlrmarginsandblock{2.5cm}{1.5cm}{*}
\setulmarginsandblock{2cm}{1.5cm}{*}

% Memoir: Warnings “The material used in the headers is too large” w/ accented titles
% https://tex.stackexchange.com/questions/387293/how-to-change-the-page-layout-with-memoir
\setheadfoot{14.0pt}{\footskip}
\checkandfixthelayout


% \def\<type>autorefname{<new name>}
\renewcommand{\tableautorefname}{Tabela}
\renewcommand{\figureautorefname}{Figura}
\renewcommand{\chapterautorefname}{Cap\'itulo}
\renewcommand{\equationautorefname}{Equa\c{c}\~ao}



% Fontes dos títulos e seções
%
% Tamanho da fonte padrão do 'ABNTEX'
\renewcommand{\normalsize}{\fontsize{10.5pt}{11pt}}

% \renewcommand{\chapnumfont}{\chaptitlefont}
% \renewcommand{\parttitlefont}{\ABNTEXpartfont\ABNTEXpartfontsize}
% \renewcommand{\partnumfont}{\ABNTEXpartfont\ABNTEXpartfontsize}
% \renewcommand{\partnamefont}{\ABNTEXpartfont\ABNTEXpartfontsize}

% Caption package and Memoir
% https://groups.google.com/forum/#!topic/comp.text.tex/RzpI2ATMev0
% https://tex.stackexchange.com/questions/18931/memoir-class-with-subcaption-and-hyperref-packages
% \DeclareCaptionFont{small}{\fontsize{9.5pt}{10.5pt}}
%
% Set caption font size in memoir
% https://tex.stackexchange.com/questions/58943/set-caption-font-size-in-memoir
\newcommand{\tabletitlesize}{\fontsize{9.5pt}{10.5pt}\selectfont}
\captionnamefont{\tabletitlesize}
\captiontitlefont{\tabletitlesize}

% Set the UFSC epigrafe font size
%
% Changing font size in an example environment
% https://tex.stackexchange.com/questions/123528/changing-font-size-in-an-example-environment
\expandafter\def\expandafter\epigrafe\expandafter{\epigrafe\tabletitlesize}

% Fonte padrão utilizada no texto
% http://tug.org/fonts/
%
% The three default family font variables and the \familydefault variable should not be confused with their respective switch:
% http://www.forkosh.com/pstex/latexcommands.htm
%
% variable value activated by
\renewcommand{\familydefault}{cmr}

%\encodingdefault   OT1 \normalfont, \textnormal{}
%\familydefault \rmdefault  \normalfont, \textnormal{}
%\rmdefault cmr \rmfamily, \textrm{}
%\ttdefault cmtt    \ttfamily, \texttt{}
%\sfdefault cmss    \sffamily, \textsf{}
%\seriesdefault m   \normalfont, \textnormal{}
%\mddefault m   \mdseries, \textmd{}
%\bfdefault bx  \bfseries, \textbf{}
%\shapedefault  n   \normalfont, \textnormal{}
%\updefault n   \upshape, \textup{}
%\itdefault it  \itshape, \textit{}
%\scdefault sc  \scshape, \textsc{}
%\sldefault sl  \slshape, \textsl{}


% Selects a roman (i.e., serifed) font family
\renewcommand{\rmdefault}{cmr}

% Selects a sans serif font family
% \renewcommand{\sfdefault}{cmss}

% Selects a monospaced (“typewriter”) font family
% \renewcommand{\ttdefault}{cmtt}

% Fontes padroes de part, chapter, section, subsection e subsubsection
\renewcommand{\ABNTEXchapterfont}{\usefont{T1}{cmr}{bx}{n}}
\renewcommand{\ABNTEXchapterfontsize}{\fontsize{10.5pt}{12pt}}

\renewcommand{\ABNTEXpartfont}{\usefont{T1}{cmr}{bx}{n}}
\renewcommand{\ABNTEXpartfontsize}{\fontsize{15pt}{18pt}}

\renewcommand{\ABNTEXsectionfont}{\usefont{T1}{cmr}{m}{n}}
\renewcommand{\ABNTEXsectionfontsize}{\fontsize{10.5pt}{12pt}}

\renewcommand{\ABNTEXsubsectionfont}{\usefont{T1}{cmr}{b}{n}}
\renewcommand{\ABNTEXsubsectionfontsize}{\fontsize{10.5pt}{12pt}}

\renewcommand{\ABNTEXsubsubsectionfont}{\usefont{T1}{cmr}{m}{n}}
\renewcommand{\ABNTEXsubsubsectionfontsize}{\fontsize{10.5pt}{12pt}}

\renewcommand{\ABNTEXsubsubsubsectionfont}{\usefont{T1}{cmr}{m}{it}}
\renewcommand{\ABNTEXsubsubsubsectionfontsize}{\fontsize{10.5pt}{12pt}}


% Comando que simula a finalizacao de uma parte no bookmark e
% adiciona espaco de \part no sumario
\renewcommand{\phantompart}
{%
    \bookmarksetup{startatroot}%
    \phantomsection%
    \addtocontents{toc}{\vspace{\cftbeforechapterskip}}
}
% -----

% No caso de Sumario (TOC) UFSC
\cftsetindents{part}{0em}{\cftlastnumwidth}
\cftsetindents{chapter}{0em}{\cftlastnumwidth}
\cftsetindents{section}{0em}{\cftlastnumwidth}
\cftsetindents{subsection}{0em}{\cftlastnumwidth}
\cftsetindents{subsubsection}{0em}{\cftlastnumwidth}
\cftsetindents{paragraph}{0em}{\cftlastnumwidth}
\cftsetindents{subparagraph}{0em}{\cftlastnumwidth}
%
\renewcommand{\tocprintchapter}
{%
    \addtocontents{toc}{\cftsetindents{chapter}{0em}{\cftlastnumwidth}}
}
%
\renewcommand{\tocinnonumchapter}
{%
    \addtocontents{toc}{\cftsetindents{chapter}{\cftlastnumwidth}{2em}}%
    \cftinserthook{toc}{A}
}
\renewcommand{\tocprintchapternonum}
{%
    \addtocontents{toc}{\cftsetindents{chapter}{\cftlastnumwidth}{2em}}
}
%
\renewcommand{\tocpartapendices}
{%
    \addtocontents{toc}{\cftsetindents{part}{\cftlastnumwidth}{2em}}
    \cftinserthook{toc}{A}
}
%
\renewcommand{\tocpartanexos}
{%
    \addtocontents{toc}{\cftsetindents{part}{\cftlastnumwidth}{2em}}
    \cftinserthook{toc}{A}
}
%
\setlength{\cftbeforechapterskip}{1em}

%
% Fontes das entradas do sumario
%
\renewcommand*{\l@chapter}[2]
{%
    \l@chapapp{\uppercase{#1}}{#2}{\cftchaptername}
}

\renewcommand*{\l@section}[2]
{%
    \l@chapapp{\ABNTEXsectionfont\uppercase{#1}}{#2}{\cftsectionname}
}

\renewcommand{\cftpartfont}{\ABNTEXpartfont}
\renewcommand{\cftpartpagefont}{\cftpartfont}

%\renewcommand{\cftchapterfont}{\ABNTEXchapterfont}
\renewcommand{\cftchapterpagefont}{\cftchapterfont}

\renewcommand{\cftsectionfont}{\ABNTEXsectionfont}
\renewcommand{\cftsectionpagefont}{\cftsectionfont}

\renewcommand{\cftsubsectionfont}{\ABNTEXsubsectionfont}
\renewcommand{\cftsubsectionpagefont}{\cftsubsectionfont}

\renewcommand{\cftsubsubsectionfont}{\ABNTEXsubsubsectionfont}
\renewcommand{\cftsubsubsectionpagefont}{\cftsubsubsectionfont}

\renewcommand{\cftparagraphfont}{\ABNTEXsubsubsubsectionfont}
\renewcommand{\cftparagraphpagefont}{\cftparagraphfont}

% Ajusta entrada Referencias
\renewcommand{\bibsection}
{
    \chapter*{\bibname}
    \bibmark
    \ifnobibintoc\else
    \phantomsection
    \addcontentsline{toc}{chapter}{\uppercase{\bibname}}
    \fi
    \prebibhook
}

% Caption package and Memoir
% https://groups.google.com/forum/#!topic/comp.text.tex/RzpI2ATMev0
% https://tex.stackexchange.com/questions/18931/memoir-class-with-subcaption-and-hyperref-packages
%
% \captionsetup[table]{
%   %  name=Tabela,
%   %  listformat=empty,
%   %  justification=justified,
%   %  labelsep=colon,
%   %   position=above,
%   %   skip=\onelineskip,
%   %  width=\linewidth,
%   labelfont={normalsize},
%   textfont={small},
%   font={normalsize}
% }

% Caption package and Memoir
% https://groups.google.com/forum/#!topic/comp.text.tex/RzpI2ATMev0
% https://tex.stackexchange.com/questions/18931/memoir-class-with-subcaption-and-hyperref-packages
%
% \captionsetup[figure]{
%   %  name=Tabela,
%   %  listformat=empty,
%   %  justification=justified,
%   %  labelsep=colon,
%   %   position=above,
%   %   skip=\onelineskip,
%   %  width=\linewidth,
%   labelfont={normalsize},
%   textfont={small},
%   font={normalsize}
% }

% Espaçamento depois do título
\setlength{\afterchapskip}{0.38cm}

% Espaçamento depois dos paragráfos
\setlength{\parskip}{0.0cm}

% Espaçamento da primeira linha do parágrafo
\setlength{\parindent}{1.0cm}

% Comando para inverter sobrenome e nome
\newcommand{\ufscthesis@inverter}[1]
{%
    \StrBehind{#1}{{}},
    \StrBefore{#1}{{}}
}

% Comandos auxiliares
\newcommand{\showfont}
{%
    (encoding: \f@encoding{},
    family: \f@family{},
    series: \f@series{},
    shape: \f@shape{},
    size: \f@size{},
    baseline: \f@baselineskip{})
    %tfsize: \tf@size{},
    %sfsize: \sf@size{},
    %sssize: \ssf@size{}
}

% Comandos auxiliares
\newcommand{\justshowfont}
{%
    (\f@encoding{},
    \f@family{},
    \f@series{},
    \f@shape{},
    \f@size{},
    \f@baselineskip{})
    %tfsize: \tf@size{},
    %sfsize: \sf@size{},
    %sssize: \ssf@size{}
}

%Numeração dos floats por capítulo
\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}


% Macros for Cross-reference
\newcommand{\figref}[1]{Figura~\ref{#1}}   % Cross-reference of figures
\newcommand{\tabref}[1]{Tabela~\ref{#1}}    % Cross-reference of tables
\newcommand{\eqnref}[1]{\eqref{#1}}      % Cross-reference of equations
\newcommand{\secref}[1]{Seção~\ref{#1}}  % Cross-reference of equations
\newcommand{\defref}[1]{Definição~\ref{#1}} %


% ------------------------------------------------------------------------
% ------------------------------------------------------------------------
% Estilo de capítulos
% ------------------------------------------------------------------------
% ------------------------------------------------------------------------

% % Custom settings
\makeatletter
\newcommand\thickhrulefill{\leavevmode \leaders \hrule height 1ex \hfill \kern \z@}

\makechapterstyle{VZ14}
{
    % \thispagestyle{empty}
    \setlength\beforechapskip{50pt}
    \setlength\midchapskip{20pt}
    \setlength\afterchapskip{20pt}
    \renewcommand\chapternamenum{}
    \renewcommand\printchaptername{}
    \renewcommand\chapnamefont{\Huge\scshape}
    \renewcommand\printchapternum
    {%
        \chapnamefont\null\thickhrulefill\quad
        \@chapapp\space\thechapter\quad\thickhrulefill
    }
    \renewcommand\printchapternonum
    {%
        \par\thickhrulefill\par\vskip\midchapskip
        \hrule\vskip\midchapskip
    }
    \renewcommand\chaptitlefont{\huge\scshape\centering}
    \renewcommand\afterchapternum
    {%
        \par\nobreak\vskip\midchapskip\hrule\vskip\midchapskip
    }
    \renewcommand\afterchaptertitle
    {%
        \par\vskip\midchapskip\hrule\nobreak\vskip\afterchapskip
    }
}
\makeatother

% Veja outros estilos em:
% http://repositorios.cpai.unb.br/ctan/info/latex-samples/MemoirChapStyles/MemoirChapStyles.pdf
\renewenvironment{resumo}[1][\resumoname]
{
    \PRIVATEbookmarkthis{#1}
    % \renewcommand{\abstractnamefont}{\chaptitlefont}
    % \renewcommand{\abstractname}{\ABNTEXchapterupperifneeded{#1}}
    \pretextualchapter{#1}
}
{
    \PRIVATEclearpageifneeded
}

% ------------------------------------------------------------------------
% ------------------------------------------------------------------------
% Configura layout
% ------------------------------------------------------------------------
% ------------------------------------------------------------------------

% ------------------------------------------------------------------------
%% criar um novo estilo incluindo logos da UFSC e do INEP
% ------------------------------------------------------------------------
\makepagestyle{abntheadingsLogo} %
\makeevenhead{abntheadingsLogo}{\ABNTEXfontereduzida\thepage}{\ABNTEXfontereduzida\textit\leftmark}{\includegraphics[width=20pt]{Logo/inep.pdf}}
\makeoddhead{abntheadingsLogo}{\includegraphics[width=15pt]{Logo/ufsc.pdf}}{\ABNTEXfontereduzida\textit\rightmark}{\ABNTEXfontereduzida\thepage}
\makeheadrule{abntheadingsLogo}{\textwidth}{\normalrulethickness}

\makeevenfoot{abntheadingsLogo}{}{}{\ABNTEXfontereduzida\textsc \imprimirautor}
\makeoddfoot{abntheadingsLogo}{\ABNTEXfontereduzida\textsc \imprimirautor}{}{}


% Configura layout para elementos textuais, redefining the ABNT command `\textual`.
% Delete his to restore the ABNT default behavior.
\renewcommand{\textual}
{
    % Estilo original do Abntex2
    \pagestyle{abntheadings}

    % Remove a numeração das páginas no início dos capítulos.
    % ABNT default value `{chapter}{abntchapfirst}`
    \aliaspagestyle{chapter}{empty}

    \nouppercaseheads
    \bookmarksetup{startatroot}
}

% ---
% Configura layout para elementos textuais
\newcommand{\textualINEPUFSC}
{
    \ifthenelse{\equal{\ABNTEXisarticle}{true}}
    {
        \pagestyle{plain}
    }
    {
        % Estilo original do Abntex2
        \pagestyle{abntheadingsLogo}

        % Remove a numeração das páginas no início dos capítulos.
        % ABNT default value `{chapter}{abntchapfirst}`
        \aliaspagestyle{chapter}{empty}
    }
    \nouppercaseheads
    \bookmarksetup{startatroot}
}


% ------------------------------------------------------------------------
% ------------------------------------------------------------------------
% Comandos e ambientes de editoracao APENDICES e ANEXOS
% ------------------------------------------------------------------------
% ------------------------------------------------------------------------
% ---
% Imprime uma pagina de divisao no estilo parte
\renewcommand{\partpage}
{
    \cleardoublepage
    % \phantomsection
    % \addcontentsline{toc}{part}{\appendixtocname}
    \appendixpage*
}


% Unable to link to inserted pages with pdfpages
% Solution from http://tex.stackexchange.com/questions/25105/unable-to-link-to-inserted-pages-with-pdfpages
\newcounter{includepdfpage}
\newcounter{currentpagecounter}

\newcommand{\addlabelstoallincludedpages}[1]
{
    \refstepcounter{includepdfpage}
    \stepcounter{currentpagecounter}
    \label{#1.\thecurrentpagecounter}
}

\newcommand{\modifiedincludepdf}[4]
{
    \setcounter{currentpagecounter}{0}
    \includepdf[pages=#1,pagecommand=\addlabelstoallincludedpages{#2},scale=#4]{#3}
}


% ---
% Impressão da Capa
\newcommand{\imprimircapaUFSC}
{%
    \begin{EnvCapaUFSC}%

        \vspace*{5cm}
        \parbox{307pt}{\center\ArialTreze \MakeUppercase{\imprimirtitulo}}
        \vfill
        \vspace*{3cm}
        \ArialCatorze\imprimirautor
        \vfill

        % Precisa ser ajustado dependendo do tamanho do titulo
        \vspace*{5.8cm}

    \end{EnvCapaUFSC}
 }
% ---


% ---
% Impressão da Capa
\renewcommand{\imprimircapa}
{%
    \begin{capa}%

        \center

        \ABNTEXchapterfont\bfseries\large{UNIVERSIDADE FEDERAL DE SANTA CATARINA\\PROGRAMA DE P\'OS--GRADUA\c C\~AO EM ENGENHARIA EL\'ETRICA}

        \vfill

        \ABNTEXchapterfont\large\imprimirautor

        \vfill
        \ABNTEXchapterfont\bfseries\Large\MakeUppercase{\imprimirtitulo}
        \vfill

        \large\imprimirlocal

        \large\imprimirdata

        \vspace*{1cm}

    \end{capa}
}
% ---


% Conteúdo padrao da Folha de Rosto
%
% Underfull \hbox (badness 10000) message
% https://tex.stackexchange.com/questions/199635/underfull-hbox-badness-10000-message
%
% Underfull \hbox (badness …) in paragraph at lines x-y
% https://tex.stackexchange.com/questions/356110/underfull-hbox-badness-in-paragraph-at-lines-x-y
%
% How to add an empty line between paragraphs?
% https://tex.stackexchange.com/questions/135134/how-to-add-an-empty-line-between-paragraphs
\makeatletter
\renewcommand{\folhaderostocontent}
{
    \begin{center}
        %\vspace*{1cm}
        {\ABNTEXchapterfont\large\imprimirautor}

        \vspace*{\fill}\vspace*{\fill}
        \begin{center}
            \ABNTEXchapterfont\bfseries\Large\imprimirtitulo
        \end{center}
        \vspace*{\fill}

        \abntex@ifnotempty{\imprimirpreambulo}
        {%
            \hspace{.45\textwidth}
            \begin{minipage}{5,5cm}

                \SingleSpacing
                \fontsize{9.5}{10.5} \selectfont \imprimirpreambulo
                \bigskip

                \fontsize{9.5}{10.5} \selectfont{\textbf{\imprimirorientadorRotulo}~\imprimirorientador\par}
                \abntex@ifnotempty{\imprimircoorientador}
                {%
                    {\textbf{\imprimircoorientadorRotulo}~\imprimircoorientador}%
                }%

            \end{minipage}%
            \vspace*{\fill}
        }%

        \vspace*{\fill}

        {\large\imprimirlocal}
        \par
        {\large\imprimirdata}
        \vspace*{1cm}

    \end{center}
}
\makeatother


% inclui subtitulo na capa, folha de rosto e ficha catalografica
% https://github.com/lrsantos11/abntex2-ufsc/commit/fd30245353dcc49e193d281c78104afe54df9fe7
%
% Cria o comando \subtitulo. A norma define que o TITULO deve ser em caixa alta
% negrito, mas o subtitulo deve ser em caixa baixa.
\providecommand{\imprimirsubtitulo}{}
\newcommand{\subtitulo}[1]{\renewcommand{\imprimirsubtitulo}{#1}}


% Example about hyphenation with ttfamily font
% https://tex.stackexchange.com/questions/386665/example-about-hyphenation-with-ttfamily-font
%
% Why the environment ttfamily is hyphenated, but macro ttfamily is not hyphenating?
% https://tex.stackexchange.com/questions/387678/why-the-environment-ttfamily-is-hyphenated-but-macro-ttfamily-is-not-hyphenatin
\usepackage{letltxmacro}
\LetLtxMacro\origttfamily\ttfamily
\DeclareRobustCommand*{\ttfamily}{%
  \origttfamily
  \hyphenchar\font=`\-\relax
  \fontdimen3\font=.25em\relax
  \fontdimen4\font=.13em\relax
  \fontdimen7\font=.167em\relax
}

\makeatletter
\DeclareRobustCommand\vttfamily{%
  \not@math@alphabet\vttfamily\relax
  \fontfamily{cmvtt}% cmvtt (Computer Modern) or lmvtt (Latin Modern)
  \selectfont
}
\DeclareTextFontCommand{\textvtt}{\vttfamily}
\makeatother

